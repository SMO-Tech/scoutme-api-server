generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// 2. ENUMS

enum MatchStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum MatchLevel {
  BEGINNER
  INTERMEDIATE
  PROFESSIONAL
  ACADEMY
  SUNDAY_LEAGUE
}

enum Gender {
  MALE
  FEMALE
  MIXED
}

enum TransactionStatus {
  PENDING
  SUCCEEDED
  FAILED
}

// 3. MODELS

model User {
  id       String  @id //firebase UID will be saved here
  email    String  @unique
  name     String
  photoUrl String?
  phone    String?

  // BUSINESS
  credits Int     @default(1) // 1 free match
  isPro   Boolean @default(false)

  // RELATIONS
  matches      Match[]
  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Match {
  id String @id@default(uuid())

  // OWNE
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // INPUT
  videoUrl String
  title    String @default("Untitled Analysis")

  // METADATA (searchable, dashboard-friendly)
  homeTeam String?
  awayTeam String?

  matchDate DateTime   @default(now())
  location  String?
  level     MatchLevel @default(INTERMEDIATE)
  gender    Gender     @default(MALE)

  // SYSTEM
  status       MatchStatus @default(PENDING)
  progress     Int         @default(0) // UI-only, best-effort
  thumbnailUrl String?

  // AI OUTPUT
  analysisData    Json?
  analysisVersion String @default("v1")


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // INDEXES
  @@index([userId])
  @@index([status])
  @@index([level, gender, location])
}

model Transaction {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  // PAYMENT
  amount       Int // stored in pennies (e.g. 1000 = Â£10.00)
  currency     String @default("GBP")
  creditsAdded Int    @default(1)

  stripeId String?
  status   TransactionStatus

  createdAt DateTime @default(now())
}
