generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


enum MatchStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum MatchLevel {
  BEGINNER
  INTERMEDIATE
  PROFESSIONAL
  ACADEMY
  SUNDAY_LEAGUE
}

enum Gender {
  MALE
  FEMALE
  MIXED
}

enum TransactionStatus {
  PENDING
  SUCCEEDED
  FAILED
}

// 3. MODELS

model User {
  id       String  @id //firebase UID will be saved here
  email    String  @unique
  name     String
  photoUrl String?
  phone    String?

  // BUSINESS
  credits Int     @default(1) // 1 free match
  isPro   Boolean @default(false)

  // RELATIONS
  matches      Match[]
  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Match {
  id String @id @default(uuid())

  // OWNER
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // --- USER INPUTS (From your Form) ---
  videoUrl  String
  homeTeam  String   // Changed to String (Required)
  awayTeam  String   // Changed to String (Required)
  matchLevel MatchLevel @default(SUNDAY_LEAGUE)  
  
  // Added for the new text area (Optional)
  focusHint String?  @db.Text 

  title     String   @default("Untitled Analysis") 
  matchDate DateTime @default(now())
  
  // Note: You aren't collecting these in the form yet, so they can stay optional/default
  location  String?
  gender    Gender      @default(MALE)
  status    MatchStatus @default(PENDING)



  // AI OUTPUT
  analysisData    Json?
  analysisVersion String @default("v1")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // INDEXES
  @@index([userId])
  @@index([status])
}

model Transaction {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  // PAYMENT
  amount       Int // stored in pennies (e.g. 1000 = Â£10.00)
  currency     String @default("GBP")
  creditsAdded Int    @default(1)

  stripeId String?
  status   TransactionStatus

  createdAt DateTime @default(now())
}
