generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String          @id
  name          String
  email         String          @unique
  phone         String?
  photoUrl      String?
  createdAt     DateTime        @default(now())
  claimRequests ClaimRequest[]
  ownedClubs    Club[]
  matches       Match[]
  ownedPlayers  PlayerProfile[]

  @@map("users")
}

model Match {
  id              String        @id @default(uuid())
  userId          String
  videoUrl        String
  lineUpImage     String?
  status          MatchStatus   @default(PENDING)
  level           MatchLevel
  matchDate       DateTime?
  competitionName String?
  venue           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  matchClubs      MatchClub[]
  matchPlayers    MatchPlayer[]
  result          MatchResult?
  user            User          @relation(fields: [userId], references: [id])

  @@map("matches")
}

model MatchResult {
  id             String             @id @default(uuid())
  matchId        String             @unique
  homeScore      Int
  awayScore      Int
  homePossession Int?
  awayPossession Int?
  homeShots      Int?
  awayShots      Int?
  rawAiOutput    Json?
  createdAt      DateTime           @default(now())
  playerStats    MatchPlayerStats[]
  match          Match              @relation(fields: [matchId], references: [id])

  @@map("match_results")
}

model MatchClub {
  id          String        @id @default(uuid())
  matchId     String
  clubId      String?
  name        String
  country     String
  isUsersTeam Boolean
  jerseyColor String?
  createdAt   DateTime      @default(now())
  club        Club?         @relation(fields: [clubId], references: [id])
  match       Match         @relation(fields: [matchId], references: [id])
  players     MatchPlayer[]

  @@unique([matchId, isUsersTeam])
  @@map("match_clubs")
}

model MatchPlayer {
  id              String            @id @default(uuid())
  playerProfileId String
  matchId         String
  jerseyNumber    Int
  position        String
  isHomeTeam      Boolean           @default(true)
  createdAt       DateTime          @default(now())
  matchClubId     String
  stats           MatchPlayerStats?
  matchClub       MatchClub         @relation(fields: [matchClubId], references: [id])
  match           Match             @relation(fields: [matchId], references: [id])
  playerProfile   PlayerProfile     @relation(fields: [playerProfileId], references: [id])

  @@unique([matchId, playerProfileId])
  @@map("match_players")
}

model MatchPlayerStats {
  id            String      @id @default(uuid())
  matchPlayerId String      @unique
  matchResultId String
  goals         Int         @default(0)
  assists       Int         @default(0)
  shots         Int         @default(0)
  shotsOnTarget Int         @default(0)
  passes        Int         @default(0)
  passAccuracy  Float?
  tackles       Int         @default(0)
  interceptions Int         @default(0)
  fouls         Int         @default(0)
  yellowCards   Int         @default(0)
  redCards      Int         @default(0)
  minutesPlayed Int?
  matchPlayer   MatchPlayer @relation(fields: [matchPlayerId], references: [id])
  matchResult   MatchResult @relation(fields: [matchResultId], references: [id])

  @@map("match_player_stats")
}

model PlayerProfile {
  id              String           @id @default(uuid())
  firstName       String
  lastName        String
  dateOfBirth     DateTime?        @db.Date
  country         String
  avatar          String?
  primaryPosition String
  status          ClaimStatus      @default(UNCLAIMED)
  ownerId         String?
  createdAt       DateTime         @default(now())
  claimRequests   ClaimRequest[]
  clubMemberships ClubMembership[]
  matchPlayers    MatchPlayer[]
  owner           User?            @relation(fields: [ownerId], references: [id])

  @@unique([firstName, lastName, dateOfBirth, country])
  @@map("player_profiles")
}

model ClubMembership {
  id              String        @id @default(uuid())
  playerProfileId String
  clubId          String
  startDate       DateTime?     @db.Date
  endDate         DateTime?     @db.Date
  isCurrent       Boolean       @default(false)
  createdAt       DateTime      @default(now())
  club            Club          @relation(fields: [clubId], references: [id])
  player          PlayerProfile @relation(fields: [playerProfileId], references: [id])

  @@map("club_memberships")
}

model Club {
  id              String           @id @default(uuid())
  name            String
  country         String
  logoUrl         String?
  status          ClaimStatus      @default(UNCLAIMED)
  ownerUserId     String?
  createdAt       DateTime         @default(now())
  claimRequests   ClaimRequest[]
  clubMemberships ClubMembership[]
  owner           User?            @relation(fields: [ownerUserId], references: [id])
  matchClubs      MatchClub[]

  @@unique([name, country])
  @@map("clubs")
}

model ClaimRequest {
  id              String         @id @default(uuid())
  userId          String
  playerId        String?
  clubId          String?
  type            ClaimType
  status          ClaimStatus    @default(PENDING)
  notes           String?
  reviewedBy      String?
  reviewedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  club            Club?          @relation(fields: [clubId], references: [id])
  player          PlayerProfile? @relation(fields: [playerId], references: [id])
  user            User           @relation(fields: [userId], references: [id])

  @@map("claim_requests")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model PlayerInfo {
  id             Int       @id @default(autoincrement())
  playerId       Int       @unique @map("player_id")
  profileType    String?   @db.VarChar(50) @map("profile_type")
  firstName      String?   @db.VarChar(100) @map("first_name")
  lastName       String?   @db.VarChar(100) @map("last_name")
  gender         String?   @db.VarChar(20)
  birthdate      DateTime? @db.Date
  city           String?   @db.VarChar(100)
  state          String?   @db.VarChar(100)
  country        String?   @db.VarChar(100)
  height         Decimal?  @db.Decimal(5, 2)
  weight         Decimal?  @db.Decimal(5, 2)
  position       String?   @db.VarChar(50)
  monthlySalary  String?   @db.VarChar(50) @map("monthly_salary")
  createdAt      DateTime? @default(now()) @db.Timestamp(6) @map("created_at")
  strongFoot     String?   @db.VarChar(20) @map("strong_foot")
  nationality    String?   @db.VarChar(80)
  contractExpiry DateTime? @db.Date @map("contract_expiry")
  league         String?   @db.VarChar(255)
  club           String?   @db.VarChar(255)
  language       String?   @db.VarChar(100)
  agentName      String?   @db.VarChar(255) @map("agent_name")

  @@map("players_info")
}

enum MatchStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum MatchLevel {
  PROFESSIONAL
  SEMI_PROFESSIONAL
  ACADEMIC_TOP_TIER
  ACADEMIC_AMATEUR
  SUNDAY_LEAGUE
}

enum ClaimStatus {
  UNCLAIMED
  PENDING
  VERIFIED
}

enum ClaimType {
  PLAYER
  CLUB
}

enum Gender {
  Male
  Female
  Other
  PreferNotToSay
}

enum Position {
  Goalkeeper
  CentreBack
  FullBack
  WingBack
  DefensiveMidfielder
  CentralMidfielder
  AttackingMidfielder
  Winger
  Striker
  SecondStriker
}

enum ProfileType {
  Agent
  Analyst
  Coach
  FootballPlayer
  Scout
}
